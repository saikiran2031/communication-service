{
  "version": 3,
  "sources": ["../../../src/adapters/primary/lambda/notifyUser.ts", "../../../src/adapters/secondary/providers/BrazeProvider.ts", "../../../src/core/services/NotificationService.ts"],
  "sourcesContent": ["import { Handler } from 'aws-lambda';\nimport { BrazeProvider } from '../../secondary/providers/BrazeProvider';\nimport { NotificationService } from '../../../core/services/NotificationService';\nimport { NotificationRequest } from '../../../core/models/Notification';\n\nconst provider = new BrazeProvider();\nconst service = new NotificationService(provider);\n\nexport const handler: Handler = async (event) => {\n    try {\n        console.log(\"Communication Service received:\", JSON.stringify(event));\n\n        // Handle SNS Records or Direct Invocation\n        const payload = event.Records ? JSON.parse(event.Records[0].Sns.Message) : event;\n\n        // Basic validation\n        if (!payload.action || !payload.userId) {\n            throw new Error('Invalid payload: Missing action or userId');\n        }\n\n        const request: NotificationRequest = {\n            action: payload.action,\n            userId: payload.userId,\n            data: payload.data || {}\n        };\n\n        await service.handleRequest(request);\n\n        return { statusCode: 200, body: JSON.stringify({ success: true }) };\n\n    } catch (error: any) {\n        console.error(\"Communication Service Error:\", error);\n        return { statusCode: 500, body: JSON.stringify({ error: error.message }) };\n    }\n};\n", "import { CommunicationProvider } from '../../../ports/CommunicationProvider';\n\n// Mocking the Braze Client logic here directly since it's simple\nexport class BrazeProvider implements CommunicationProvider {\n\n    async sendWelcomeEmail(userId: string, email: string, userName: string): Promise<void> {\n        console.log(`[Braze MOCK] Sending Welcome Email to ${email} (${userName})`);\n        // Simulate API call\n        await new Promise(resolve => setTimeout(resolve, 100));\n    }\n\n    async sendPushNotification(userId: string, title: string, message: string, extra?: any): Promise<void> {\n        console.log(`[Braze MOCK] Push to ${userId}: ${title} - ${message}`, extra);\n        await new Promise(resolve => setTimeout(resolve, 100));\n    }\n\n    async sendPointsMilestone(userId: string, points: number): Promise<void> {\n        console.log(`[Braze MOCK] Points Milestone for ${userId}: ${points} pts`);\n        await new Promise(resolve => setTimeout(resolve, 100));\n    }\n\n    async trackEvent(userId: string, eventName: string, properties?: any): Promise<void> {\n        console.log(`[Braze MOCK] Track Event for ${userId}: ${eventName}`, properties);\n        await new Promise(resolve => setTimeout(resolve, 100));\n    }\n}\n", "import { CommunicationProvider } from '../../ports/CommunicationProvider';\nimport { NotificationRequest } from '../models/Notification';\n\nexport class NotificationService {\n    constructor(private provider: CommunicationProvider) { }\n\n    async handleRequest(request: NotificationRequest): Promise<void> {\n        console.log(`Processing action: ${request.action} for user: ${request.userId}`);\n\n        switch (request.action) {\n            case 'WELCOME_EMAIL':\n                await this.provider.sendWelcomeEmail(\n                    request.userId,\n                    request.data.email,\n                    request.data.userName\n                );\n                break;\n\n            case 'PUSH_NOTIFICATION':\n                await this.provider.sendPushNotification(\n                    request.userId,\n                    request.data.title,\n                    request.data.message,\n                    request.data.extra\n                );\n                break;\n\n            case 'POINTS_MILESTONE':\n                await this.provider.sendPointsMilestone(\n                    request.userId,\n                    request.data.pointsBalance\n                );\n                break;\n\n            case 'TRACK_EVENT':\n                await this.provider.trackEvent(\n                    request.userId,\n                    request.data.eventName,\n                    request.data.properties\n                );\n                break;\n\n            default:\n                console.warn(`Unknown action: ${request.action}`);\n        }\n    }\n}\n"],
  "mappings": "yaAAA,IAAAA,EAAA,GAAAC,EAAAD,EAAA,aAAAE,IAAA,eAAAC,EAAAH,GCGO,IAAMI,EAAN,KAAqD,CAExD,MAAM,iBAAiBC,EAAgBC,EAAeC,EAAiC,CACnF,QAAQ,IAAI,yCAAyCD,CAAK,KAAKC,CAAQ,GAAG,EAE1E,MAAM,IAAI,QAAQC,GAAW,WAAWA,EAAS,GAAG,CAAC,CACzD,CAEA,MAAM,qBAAqBH,EAAgBI,EAAeC,EAAiBC,EAA4B,CACnG,QAAQ,IAAI,wBAAwBN,CAAM,KAAKI,CAAK,MAAMC,CAAO,GAAIC,CAAK,EAC1E,MAAM,IAAI,QAAQH,GAAW,WAAWA,EAAS,GAAG,CAAC,CACzD,CAEA,MAAM,oBAAoBH,EAAgBO,EAA+B,CACrE,QAAQ,IAAI,qCAAqCP,CAAM,KAAKO,CAAM,MAAM,EACxE,MAAM,IAAI,QAAQJ,GAAW,WAAWA,EAAS,GAAG,CAAC,CACzD,CAEA,MAAM,WAAWH,EAAgBQ,EAAmBC,EAAiC,CACjF,QAAQ,IAAI,gCAAgCT,CAAM,KAAKQ,CAAS,GAAIC,CAAU,EAC9E,MAAM,IAAI,QAAQN,GAAW,WAAWA,EAAS,GAAG,CAAC,CACzD,CACJ,ECtBO,IAAMO,EAAN,KAA0B,CAC7B,YAAoBC,EAAiC,CAAjC,cAAAA,CAAmC,CAEvD,MAAM,cAAcC,EAA6C,CAG7D,OAFA,QAAQ,IAAI,sBAAsBA,EAAQ,MAAM,cAAcA,EAAQ,MAAM,EAAE,EAEtEA,EAAQ,OAAQ,CACpB,IAAK,gBACD,MAAM,KAAK,SAAS,iBAChBA,EAAQ,OACRA,EAAQ,KAAK,MACbA,EAAQ,KAAK,QACjB,EACA,MAEJ,IAAK,oBACD,MAAM,KAAK,SAAS,qBAChBA,EAAQ,OACRA,EAAQ,KAAK,MACbA,EAAQ,KAAK,QACbA,EAAQ,KAAK,KACjB,EACA,MAEJ,IAAK,mBACD,MAAM,KAAK,SAAS,oBAChBA,EAAQ,OACRA,EAAQ,KAAK,aACjB,EACA,MAEJ,IAAK,cACD,MAAM,KAAK,SAAS,WAChBA,EAAQ,OACRA,EAAQ,KAAK,UACbA,EAAQ,KAAK,UACjB,EACA,MAEJ,QACI,QAAQ,KAAK,mBAAmBA,EAAQ,MAAM,EAAE,CACxD,CACJ,CACJ,EFzCA,IAAMC,EAAW,IAAIC,EACfC,EAAU,IAAIC,EAAoBH,CAAQ,EAEnCI,EAAmB,MAAOC,GAAU,CAC7C,GAAI,CACA,QAAQ,IAAI,kCAAmC,KAAK,UAAUA,CAAK,CAAC,EAGpE,IAAMC,EAAUD,EAAM,QAAU,KAAK,MAAMA,EAAM,QAAQ,CAAC,EAAE,IAAI,OAAO,EAAIA,EAG3E,GAAI,CAACC,EAAQ,QAAU,CAACA,EAAQ,OAC5B,MAAM,IAAI,MAAM,2CAA2C,EAG/D,IAAMC,EAA+B,CACjC,OAAQD,EAAQ,OAChB,OAAQA,EAAQ,OAChB,KAAMA,EAAQ,MAAQ,CAAC,CAC3B,EAEA,aAAMJ,EAAQ,cAAcK,CAAO,EAE5B,CAAE,WAAY,IAAK,KAAM,KAAK,UAAU,CAAE,QAAS,EAAK,CAAC,CAAE,CAEtE,OAASC,EAAY,CACjB,eAAQ,MAAM,+BAAgCA,CAAK,EAC5C,CAAE,WAAY,IAAK,KAAM,KAAK,UAAU,CAAE,MAAOA,EAAM,OAAQ,CAAC,CAAE,CAC7E,CACJ",
  "names": ["notifyUser_exports", "__export", "handler", "__toCommonJS", "BrazeProvider", "userId", "email", "userName", "resolve", "title", "message", "extra", "points", "eventName", "properties", "NotificationService", "provider", "request", "provider", "BrazeProvider", "service", "NotificationService", "handler", "event", "payload", "request", "error"]
}
